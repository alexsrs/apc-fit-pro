
# APC FIT PRO - Backend API

Este Ã© o backend do **APC FIT PRO**, uma API RESTful robusta para gerenciamento de avaliaÃ§Ãµes fÃ­sicas, prescriÃ§Ã£o e controle de treinos baseada no mÃ©todo APC (AvaliaÃ§Ã£o, PrescriÃ§Ã£o e Controle).

A API foi desenvolvida com [Node.js](https://nodejs.org) e utiliza as melhores prÃ¡ticas de desenvolvimento para garantir performance, seguranÃ§a e escalabilidade.

## ğŸš€ Tecnologias Utilizadas

- **[Node.js 20+](https://nodejs.org)** - Ambiente de execuÃ§Ã£o JavaScript
- **[TypeScript](https://www.typescriptlang.org)** - Tipagem estÃ¡tica para JavaScript
- **[Express.js](https://expressjs.com)** - Framework web minimalista e flexÃ­vel
- **[Prisma](https://www.prisma.io)** - ORM moderno com type-safety
- **[PostgreSQL](https://www.postgresql.org)** - Banco de dados relacional avanÃ§ado
- **[JWT](https://jwt.io)** - AutenticaÃ§Ã£o e autorizaÃ§Ã£o segura
- **[Bcrypt](https://github.com/kelektiv/node.bcrypt.js)** - Hash de senhas criptogrÃ¡fico
- **[Joi](https://joi.dev)** - ValidaÃ§Ã£o de dados robusta
- **[Swagger](https://swagger.io)** - DocumentaÃ§Ã£o automÃ¡tica da API

## ğŸ¯ Funcionalidades Principais

### ğŸ” **Sistema de AutenticaÃ§Ã£o**
- AutenticaÃ§Ã£o JWT com refresh tokens
- Hash seguro de senhas com bcrypt
- Middleware de autorizaÃ§Ã£o por roles
- ValidaÃ§Ã£o e sanitizaÃ§Ã£o de dados

### ğŸ“Š **Sistema de AvaliaÃ§Ãµes FÃ­sicas**
- **API de Triagem**: ClassificaÃ§Ã£o automÃ¡tica de objetivos com algoritmo APC
- **API de Anamnese**: Processamento de dados estratÃ©gicos de saÃºde
- **API de Medidas Corporais**: CÃ¡lculos automÃ¡ticos de IMC, %GC, RCQ, CA
- **API de Resultados**: Processamento e anÃ¡lise de dados antropomÃ©tricos

### ğŸ‘¥ **GestÃ£o de UsuÃ¡rios**
- CRUD completo de usuÃ¡rios (Personal e Alunos)
- Sistema de perfis diferenciados
- GestÃ£o de convites e relacionamentos
- Upload e processamento de imagens

### ğŸ“ˆ **Analytics e RelatÃ³rios**
- Processamento de evoluÃ§Ã£o fÃ­sica
- GeraÃ§Ã£o de relatÃ³rios em PDF
- MÃ©tricas de performance
- Logs de auditoria

## ğŸ—ï¸ Estrutura do Projeto

```
apcpro-api/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controllers/             # Controladores HTTP
â”‚   â”‚   â”œâ”€â”€ auth-controller.ts   # AutenticaÃ§Ã£o e autorizaÃ§Ã£o
â”‚   â”‚   â”œâ”€â”€ users-controller.ts  # GestÃ£o de usuÃ¡rios
â”‚   â”‚   â”œâ”€â”€ avaliacao-controller.ts # AvaliaÃ§Ãµes fÃ­sicas
â”‚   â”‚   â”œâ”€â”€ avaliarCA-controller.ts # CircunferÃªncia Abdominal
â”‚   â”‚   â””â”€â”€ ...                  # Outros controladores
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                # LÃ³gica de negÃ³cio
â”‚   â”‚   â”œâ”€â”€ auth-service.ts      # ServiÃ§os de autenticaÃ§Ã£o
â”‚   â”‚   â”œâ”€â”€ users-service.ts     # ServiÃ§os de usuÃ¡rios
â”‚   â”‚   â”œâ”€â”€ avaliacao-service.ts # ServiÃ§os de avaliaÃ§Ã£o
â”‚   â”‚   â”œâ”€â”€ ca-service.ts        # ServiÃ§os de CA
â”‚   â”‚   â”œâ”€â”€ rcq-service.ts       # ServiÃ§os de RCQ
â”‚   â”‚   â””â”€â”€ ...                  # Outros serviÃ§os
â”‚   â”‚
â”‚   â”œâ”€â”€ repositories/            # Camada de dados (Prisma)
â”‚   â”‚   â”œâ”€â”€ users-repository.ts  # RepositÃ³rio de usuÃ¡rios
â”‚   â”‚   â”œâ”€â”€ avaliacoes-repository.ts # RepositÃ³rio de avaliaÃ§Ãµes
â”‚   â”‚   â””â”€â”€ ...                  # Outros repositÃ³rios
â”‚   â”‚
â”‚   â”œâ”€â”€ middlewares/             # Middlewares Express
â”‚   â”‚   â”œâ”€â”€ auth-middleware.ts   # AutenticaÃ§Ã£o JWT
â”‚   â”‚   â”œâ”€â”€ validation-middleware.ts # ValidaÃ§Ã£o de dados
â”‚   â”‚   â”œâ”€â”€ error-middleware.ts  # Tratamento de erros
â”‚   â”‚   â””â”€â”€ cors-middleware.ts   # ConfiguraÃ§Ã£o CORS
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                  # Tipos e Interfaces
â”‚   â”‚   â”œâ”€â”€ user-model.ts        # Modelos de usuÃ¡rio
â”‚   â”‚   â”œâ”€â”€ avaliacao-model.ts   # Modelos de avaliaÃ§Ã£o
â”‚   â”‚   â”œâ”€â”€ ca-model.ts          # Modelos de CA
â”‚   â”‚   â”œâ”€â”€ rcq-model.ts         # Modelos de RCQ
â”‚   â”‚   â”œâ”€â”€ genero-model.ts      # Enum de gÃªnero
â”‚   â”‚   â””â”€â”€ ...                  # Outros modelos
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                   # FunÃ§Ãµes utilitÃ¡rias
â”‚   â”‚   â”œâ”€â”€ avaliacaoMedidas.ts  # CÃ¡lculos antropomÃ©tricos
â”‚   â”‚   â”œâ”€â”€ avaliacaoProcessor.ts # Processamento de avaliaÃ§Ãµes
â”‚   â”‚   â”œâ”€â”€ conversorMedidas.ts  # ConversÃ£o de medidas
â”‚   â”‚   â”œâ”€â”€ jwt-utils.ts         # UtilitÃ¡rios JWT
â”‚   â”‚   â”œâ”€â”€ hash-utils.ts        # UtilitÃ¡rios de hash
â”‚   â”‚   â””â”€â”€ ...                  # Outras utilidades
â”‚   â”‚
â”‚   â”œâ”€â”€ validators/              # Schemas de validaÃ§Ã£o
â”‚   â”‚   â”œâ”€â”€ auth-validators.ts   # ValidaÃ§Ã£o de autenticaÃ§Ã£o
â”‚   â”‚   â”œâ”€â”€ user-validators.ts   # ValidaÃ§Ã£o de usuÃ¡rios
â”‚   â”‚   â””â”€â”€ ...                  # Outros validadores
â”‚   â”‚
â”‚   â”œâ”€â”€ app.ts                   # ConfiguraÃ§Ã£o do Express
â”‚   â”œâ”€â”€ server.ts                # Entry point da aplicaÃ§Ã£o
â”‚   â”œâ”€â”€ routes.ts                # DefiniÃ§Ã£o de rotas
â”‚   â”œâ”€â”€ prisma.ts                # Cliente Prisma
â”‚   â””â”€â”€ swagger.ts               # ConfiguraÃ§Ã£o Swagger
â”‚
â”œâ”€â”€ prisma/                      # Schema e migraÃ§Ãµes
â”‚   â”œâ”€â”€ schema.prisma            # DefiniÃ§Ãµes do banco
â”‚   â””â”€â”€ migrations/              # MigraÃ§Ãµes do banco
â”‚
â”œâ”€â”€ docs/                        # DocumentaÃ§Ã£o
â”‚   â””â”€â”€ architeture.tldr         # Diagrama de arquitetura
â”‚
â”œâ”€â”€ Dockerfile                   # Container Docker
â”œâ”€â”€ tsconfig.json                # ConfiguraÃ§Ã£o TypeScript
â”œâ”€â”€ package.json                 # DependÃªncias e scripts
â””â”€â”€ web.config                   # ConfiguraÃ§Ã£o Azure
```

## ğŸ› ï¸ Comandos Principais

### Desenvolvimento
```bash
# Instalar dependÃªncias
npm install

# Executar em modo desenvolvimento
npm run start:dev

# Executar com watch (auto-reload)
npm run start:watch

# Verificar tipos TypeScript
npm run type-check
```

### Build e Deploy
```bash
# Compilar TypeScript
npm run dist

# Executar build compilado
npm run start:dist

# Build para produÃ§Ã£o
npm run build

# Executar em produÃ§Ã£o
npm start
```

### Banco de Dados (Prisma)
```bash
# Gerar cliente Prisma
npx prisma generate

# Executar migraÃ§Ãµes
npx prisma migrate dev

# Deploy migraÃ§Ãµes (produÃ§Ã£o)
npx prisma migrate deploy

# Visualizar dados (Prisma Studio)
npx prisma studio

# Reset do banco (apenas desenvolvimento)
npx prisma migrate reset
```

### Testes e Qualidade
```bash
# Executar testes
npm test

# Executar testes em watch
npm run test:watch

# Cobertura de testes
npm run test:coverage

# Linting
npm run lint

# FormataÃ§Ã£o de cÃ³digo
npm run format
```

## ğŸ¨ PadrÃµes de Desenvolvimento

### Estrutura de Controlador
```typescript
// Exemplo de controlador padronizado
import { Request, Response, NextFunction } from "express";
import { UsuarioService } from "../services/usuario-service";
import { ok, badRequest, notFound } from "../utils/response-helper";

export class UsuarioController {
  private usuarioService: UsuarioService;

  constructor() {
    this.usuarioService = new UsuarioService();
  }

  async criarUsuario(req: Request, res: Response, next: NextFunction) {
    try {
      const dadosUsuario = req.body;
      const novoUsuario = await this.usuarioService.criar(dadosUsuario);
      return res.status(201).json(ok(novoUsuario));
    } catch (error) {
      next(error);
    }
  }

  async obterUsuario(req: Request, res: Response, next: NextFunction) {
    try {
      const { id } = req.params;
      const usuario = await this.usuarioService.obterPorId(id);
      
      if (!usuario) {
        return res.status(404).json(notFound("UsuÃ¡rio nÃ£o encontrado"));
      }
      
      return res.json(ok(usuario));
    } catch (error) {
      next(error);
    }
  }
}
```

### Estrutura de ServiÃ§o
```typescript
// Exemplo de serviÃ§o padronizado
import { PrismaClient } from "@prisma/client";
import { UsuarioModel, CriarUsuarioInput } from "../models/usuario-model";
import { HashService } from "./hash-service";

export class UsuarioService {
  private prisma: PrismaClient;
  private hashService: HashService;

  constructor() {
    this.prisma = new PrismaClient();
    this.hashService = new HashService();
  }

  async criar(dados: CriarUsuarioInput): Promise<UsuarioModel> {
    // Hash da senha
    const senhaHash = await this.hashService.hash(dados.senha);
    
    // Criar usuÃ¡rio no banco
    const novoUsuario = await this.prisma.user.create({
      data: {
        ...dados,
        senha: senhaHash,
      },
    });

    // Remover senha do retorno
    const { senha, ...usuarioSemSenha } = novoUsuario;
    return usuarioSemSenha as UsuarioModel;
  }

  async obterPorId(id: string): Promise<UsuarioModel | null> {
    const usuario = await this.prisma.user.findUnique({
      where: { id },
      select: {
        id: true,
        email: true,
        name: true,
        // ... outros campos (exceto senha)
      },
    });

    return usuario;
  }
}
```

### Nomenclatura
- **Classes**: PascalCase (`UsuarioService`)
- **Arquivos**: kebab-case (`usuario-service.ts`)
- **VariÃ¡veis/FunÃ§Ãµes**: camelCase (`criarUsuario`)
- **Constantes**: SNAKE_CASE (`MAX_UPLOAD_SIZE`)
- **Interfaces**: PascalCase com sufixo (`UsuarioModel`, `CriarUsuarioInput`)

## ğŸ”§ ConfiguraÃ§Ãµes Importantes

### VariÃ¡veis de Ambiente
Crie um arquivo `.env` com as seguintes variÃ¡veis:

```env
# Porta do servidor
PORT=8000

# Banco de Dados
DATABASE_URL="postgresql://usuario:senha@localhost:5432/apcfitpro"

# JWT
JWT_SECRET=sua_chave_jwt_super_secreta_aqui
JWT_EXPIRES_IN=24h
JWT_REFRESH_SECRET=sua_chave_refresh_jwt_aqui
JWT_REFRESH_EXPIRES_IN=7d

# Bcrypt
BCRYPT_ROUNDS=12

# CORS
CORS_ORIGIN=http://localhost:3000

# Upload
MAX_FILE_SIZE=5242880
UPLOAD_PATH=./uploads

# Email (se implementado)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=seu_email@gmail.com
SMTP_PASS=sua_senha_app

# API Externa (se necessÃ¡rio)
OPENAI_API_KEY=sua_chave_openai
```

### ConfiguraÃ§Ã£o do Banco
A API utiliza PostgreSQL com Prisma ORM:

```bash
# Primeira configuraÃ§Ã£o
npx prisma migrate dev --name init
npx prisma generate
```

## ğŸ“Š Endpoints Principais

### AutenticaÃ§Ã£o
```
POST   /auth/login           # Login de usuÃ¡rio
POST   /auth/register        # Cadastro de usuÃ¡rio
POST   /auth/refresh         # Renovar token
POST   /auth/logout          # Logout
POST   /auth/forgot-password # Esqueci minha senha
POST   /auth/reset-password  # Redefinir senha
```

### UsuÃ¡rios
```
GET    /users               # Listar usuÃ¡rios
GET    /users/:id           # Obter usuÃ¡rio por ID
POST   /users               # Criar usuÃ¡rio
PUT    /users/:id           # Atualizar usuÃ¡rio
DELETE /users/:id           # Deletar usuÃ¡rio
POST   /users/:id/avatar    # Upload de avatar
```

### AvaliaÃ§Ãµes
```
GET    /avaliacoes          # Listar avaliaÃ§Ãµes
GET    /avaliacoes/:id      # Obter avaliaÃ§Ã£o por ID
POST   /avaliacoes          # Criar avaliaÃ§Ã£o
PUT    /avaliacoes/:id      # Atualizar avaliaÃ§Ã£o
DELETE /avaliacoes/:id      # Deletar avaliaÃ§Ã£o
POST   /avaliacoes/medidas  # Calcular medidas corporais
```

### AvaliaÃ§Ãµes EspecÃ­ficas
```
POST   /avaliar-ca          # Avaliar CircunferÃªncia Abdominal
POST   /avaliar-rcq         # Avaliar RelaÃ§Ã£o Cintura-Quadril
POST   /avaliar-imc         # Avaliar Ãndice de Massa Corporal
POST   /processar-medidas   # Processar todas as medidas
```

## ğŸš€ Deploy

### Docker
```bash
# Build da imagem
docker build -t apc-fit-pro-api .

# Executar container
docker run -p 8000:8000 apc-fit-pro-api
```

### Azure App Service
1. Configure as variÃ¡veis de ambiente no portal Azure
2. Use o arquivo `web.config` incluÃ­do
3. Deploy automÃ¡tico via GitHub Actions

### Outros Provedores
- Configure as variÃ¡veis de ambiente
- Execute `npm run build`
- Inicie com `npm start`
- Node.js version: 20+

## ğŸ“š Recursos Adicionais

### DocumentaÃ§Ã£o das Tecnologias
- **[Node.js Documentation](https://nodejs.org/docs)** - DocumentaÃ§Ã£o oficial do Node.js
- **[Express.js Guide](https://expressjs.com/guide)** - Guia completo do Express
- **[Prisma Documentation](https://www.prisma.io/docs)** - DocumentaÃ§Ã£o do Prisma ORM
- **[TypeScript Handbook](https://www.typescriptlang.org/docs)** - Manual do TypeScript
- **[PostgreSQL Documentation](https://www.postgresql.org/docs)** - DocumentaÃ§Ã£o do PostgreSQL

### API Documentation
- **Swagger UI**: Acesse `/api-docs` quando o servidor estiver rodando
- **Postman Collection**: DisponÃ­vel na pasta `/docs`

### Links Ãšteis
- **[RepositÃ³rio GitHub](https://github.com/seu-usuario/apc-fit-pro)** - CÃ³digo fonte
- **[Issues & Features](https://github.com/seu-usuario/apc-fit-pro/issues)** - Reportar bugs
- **[Azure Portal](https://portal.azure.com)** - Gerenciar recursos Azure

## ğŸ¤ ContribuiÃ§Ã£o

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/nova-funcionalidade`)
3. Commit suas mudanÃ§as (`git commit -m 'feat: adiciona nova funcionalidade'`)
4. Push para a branch (`git push origin feature/nova-funcionalidade`)
5. Abra um Pull Request

### ConvenÃ§Ãµes de Commit
- `feat:` - Nova funcionalidade
- `fix:` - CorreÃ§Ã£o de bug
- `docs:` - DocumentaÃ§Ã£o
- `style:` - FormataÃ§Ã£o/estilo
- `refactor:` - RefatoraÃ§Ã£o de cÃ³digo
- `test:` - AdiÃ§Ã£o de testes
- `chore:` - Tarefas de manutenÃ§Ã£o
- `perf:` - Melhorias de performance

### PadrÃµes de CÃ³digo
- Use TypeScript strict mode
- Implemente testes para novas funcionalidades
- Mantenha coverage acima de 80%
- Documente APIs com comentÃ¡rios JSDoc
- Siga os padrÃµes ESLint configurados

## ğŸ“„ LicenÃ§a

Este projeto estÃ¡ licenciado sob a licenÃ§a MIT. Consulte o arquivo `LICENSE` para mais detalhes.

## ğŸ‘¥ Equipe

Desenvolvido com â¤ï¸ pela equipe APC FIT PRO.

---

**APC FIT PRO** - Transformando a avaliaÃ§Ã£o fÃ­sica atravÃ©s da tecnologia.
